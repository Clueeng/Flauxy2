package uwu.noctura.module.impl.exploit;

import io.netty.buffer.Unpooled;
import net.minecraft.block.BlockLiquid;
import net.minecraft.init.Items;
import net.minecraft.item.ItemStack;
import net.minecraft.nbt.NBTBase;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.nbt.NBTTagList;
import net.minecraft.nbt.NBTTagString;
import net.minecraft.network.Packet;
import net.minecraft.network.PacketBuffer;
import net.minecraft.network.play.client.C0BPacketEntityAction;
import net.minecraft.network.play.client.C17PacketCustomPayload;
import net.minecraft.util.BlockPos;
import uwu.noctura.Noctura;
import uwu.noctura.event.Event;
import uwu.noctura.event.impl.EventMotion;
import uwu.noctura.event.impl.EventSendPacket;
import uwu.noctura.event.impl.EventUpdate;
import uwu.noctura.module.Category;
import uwu.noctura.module.Module;
import uwu.noctura.module.ModuleInfo;
import uwu.noctura.module.setting.impl.GraphSetting;
import uwu.noctura.module.setting.impl.ModeSetting;
import uwu.noctura.notification.Notification;
import uwu.noctura.notification.NotificationType;
import uwu.noctura.utils.BlockUtil;
import uwu.noctura.utils.MoveUtils;
import uwu.noctura.utils.PacketUtil;
import uwu.noctura.utils.Wrapper;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Random;

@ModuleInfo(name = "TestModule", displayName = "Test Module", key = -1, cat = Category.Exploit)
public class TestModule extends Module {

    //public GraphSetting graph = new GraphSetting("Graph",1,1,0,10,0,10,1,1);
    public ModeSetting falses = new ModeSetting("Mode", "BP J", "BP J", "BP C", "Move E", "Move J", "Random");

    public TestModule(){
        addSettings(falses);
    }

    @Override
    public void onEnable() {
        tick = 0;
        //Noctura.INSTANCE.getNotificationManager().addToQueue(new Notification(NotificationType.INFO,"Blur testing", "tenatitty blur edition"));
    }

    int tick;

    @Override
    public void onEvent(Event e) {
        if(e instanceof EventMotion){
            EventMotion em = (EventMotion)e;
            switch (falses.getMode()){
                case "Random":{
                    MoveUtils.setSpeed(
                            9.50f
                    );
                    break;
                }
                case "Move J":{
                    if(!mc.thePlayer.onGround && tick < 20){
                        float r = new Random().nextFloat() / 2f;
                        mc.thePlayer.motionY *= (1.0f + r);
                        tick++;
                    }
                    if(tick >= 20){
                        this.toggle();
                    }
                    //mc.thePlayer.jumpMovementFactor = 0.2f;
                    break;
                }
                case "Move E":{
                    if(BlockUtil.isOnLiquid(0.001))
                        if(BlockUtil.isTotalOnLiquid(0.001) && mc.thePlayer.onGround && !mc.thePlayer.isInWater()){
                            em.setY(em.getY() + (mc.thePlayer.ticksExisted % 2 == 0 ? 0.0000000001D : -0.000000000001D));
                            mc.thePlayer.setPosition(mc.thePlayer.posX, em.getY() + (mc.thePlayer.ticksExisted % 2 == 0 ? 0.0000000001D : -0.000000000001D),
                            mc.thePlayer.posZ);
                        }
                    break;
                }
            }
        }
        if(e instanceof EventUpdate){
            if(mc.thePlayer.ticksExisted < 10){
                this.toggle();
            }
            switch (falses.getMode()){
                case "BP J":{
                    PacketUtil.sendSilentPacket(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.START_SPRINTING));
                    PacketUtil.sendSilentPacket(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.STOP_SPRINTING));
                    if(mc.thePlayer.ticksExisted % 10 == 0){
                        PacketUtil.sendSilentPacket(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.START_SNEAKING));
                        PacketUtil.sendSilentPacket(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.STOP_SNEAKING));
                    }
                    break;
                }
                case "BP C":{
                    EventUpdate ev = (EventUpdate)e;
                    if(!ev.isPre()){
                        return;
                    }
                    if(mc.thePlayer.ticksExisted < 10){
                        this.toggle();
                        return;
                    }
                    ItemStack bookStack;
                    NBTTagCompound bookCompound;
                    NBTTagList pageList;
                    String pageText;
                    int page, packets;
                    double x, y, z;
                    int i;

                    bookStack = new ItemStack(Items.writable_book);
                    bookCompound = new NBTTagCompound();
                    bookCompound.setInteger("author", 20);
                    bookCompound.setInteger("title", 20);
                    pageList = new NBTTagList();
                    pageText = String.valueOf(600);
                    for (page = 0; page < 50; page++)
                        pageList.appendTag((NBTBase) new NBTTagString(pageText));
                    bookCompound.setTag("pages", (NBTBase) pageList);
                    bookStack.writeToNBT(bookCompound);
                    for (packets = 0; packets < 100; packets++) {
                        PacketBuffer packetBuffer = new PacketBuffer(Unpooled.buffer());
                        packetBuffer.writeItemStackToBuffer(bookStack);
                        PacketUtil.sendSilentPacket((Packet) new C17PacketCustomPayload((new Random()).nextBoolean() ? "MC|BSign" : "MC|BEdit", packetBuffer));
                    }

                    //PacketBuffer packetBuffer = new PacketBuffer(Unpooled.buffer());
                    //PacketUtil.sendSilentPacket(new C17PacketCustomPayload("MC|BSign", packetBuffer));
                    break;
                }

            }
        }
        if(e instanceof EventSendPacket){
            EventSendPacket ev = (EventSendPacket) e;

        }
    }

    boolean shouldJesus(){
        double x = mc.thePlayer.posX; double y = mc.thePlayer.posY; double z = mc.thePlayer.posZ;
        ArrayList<BlockPos>pos = new ArrayList<BlockPos>(Arrays.asList(new BlockPos(x + 0.3, y, z+0.3),
                new BlockPos(x - 0.3, y, z+0.3),new BlockPos(x + 0.3, y, z-0.3),new BlockPos(x - 0.3, y, z-0.3)));
        for(BlockPos po : pos){
            if(!(mc.theWorld.getBlockState(po).getBlock() instanceof BlockLiquid))
                continue;
            if(mc.theWorld.getBlockState(po).getProperties().get(BlockLiquid.LEVEL) instanceof Integer){
                if((int)mc.theWorld.getBlockState(po).getProperties().get(BlockLiquid.LEVEL) <= 4){
                    return true;
                }
            }
        }


        return false;
    }
    public double getMotionY(double stage){
        stage --;
        double[] motion = new double[]{0.500,0.484,0.468,0.436,0.404,0.372,0.340,0.308,0.276,0.244,0.212,0.180,0.166,0.166,
                0.156,0.123,0.135,0.111,0.086,0.098,0.073,0.048,0.06,0.036,0.0106,0.015,0.004,0.004,0.004,0.004,
                -0.013,-0.045,-0.077,-0.109};
        if(stage < motion.length && stage >= 0)
            return motion[(int)stage];
        else
            return -999;

    }
    private boolean shouldSetBoundingBox() {
        return (!mc.thePlayer.isSneaking()) && (mc.thePlayer.fallDistance < 12.0F);
    }

}
